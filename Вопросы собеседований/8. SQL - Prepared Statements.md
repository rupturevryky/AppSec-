
## üõ°Ô∏è Prepared Statements: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

**Prepared Statements**¬†(–ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —à–∞–±–ª–æ–Ω –∑–∞–ø—Ä–æ—Å–∞ –∏ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π –∏ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

---

## üéØ¬†**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç Prepared Statements**

### –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å (—É—è–∑–≤–∏–º—ã–π):

```sql
-- –ü—Ä—è–º–∞—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ - –û–ü–ê–°–ù–û!
SELECT * FROM users WHERE username = '" + username + "' AND password = '" + password + "'
```

### Prepared Statement (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π):

```sql
-- –®–∞–±–ª–æ–Ω —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
SELECT * FROM users WHERE username = ? AND password = ?
```

### –ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (Prepare)**: SQL-—Å–µ—Ä–≤–µ—Ä –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç —à–∞–±–ª–æ–Ω –∑–∞–ø—Ä–æ—Å–∞
2. **–ü—Ä–∏–≤—è–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (Bind)**: –ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
3. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (Execute)**: –ó–∞–ø—É—Å–∫ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

```js
// –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞
const stmt = db.prepare("INSERT INTO users (name, email) VALUES (?, ?)");
stmt.bind("John", "john@example.com");
stmt.execute();
```

---

## üîß¬†**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö**

### **Java/JDBC:**

```Java
// –£—è–∑–≤–∏–º—ã–π –ø–æ–¥—Ö–æ–¥
String sql = "SELECT * FROM users WHERE email = '" + email + "'";
Statement stmt = connection.createStatement();
ResultSet rs = stmt.executeQuery(sql);

// –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å PreparedStatement
String sql = "SELECT * FROM users WHERE email = ?";
PreparedStatement stmt = connection.prepareStatement(sql);
stmt.setString(1, email); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞
ResultSet rs = stmt.executeQuery();
```

### **Python/Psycopg2 (PostgreSQL):**

```python
# –û–ü–ê–°–ù–û - SQL injection
cursor.execute(f"SELECT * FROM users WHERE name = '{username}'")

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ - prepared statement
cursor.execute("SELECT * FROM users WHERE name = %s", (username,))

# –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
data = [('John', 'john@email.com'), ('Jane', 'jane@email.com')]
cursor.executemany(
    "INSERT INTO users (name, email) VALUES (%s, %s)",
    data
)
```

### **PHP/PDO:**

```php
// –û–ü–ê–°–ù–´–ô –ø–æ–¥—Ö–æ–¥
$sql = "SELECT * FROM users WHERE email = '$email'";
$result = $pdo->query($sql);

// –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
$sql = "SELECT * FROM users WHERE email = :email";
$stmt = $pdo->prepare($sql);
$stmt->bindParam(':email', $email, PDO::PARAM_STR);
$stmt->execute();
$result = $stmt->fetchAll();
```

### **Node.js\/mysql2:**

```js
// –£—è–∑–≤–∏–º—ã–π –ø–æ–¥—Ö–æ–¥
connection.query(`SELECT * FROM users WHERE name = '${username}'`);

// –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
connection.execute(
    'SELECT * FROM users WHERE name = ? AND age > ?',
    [username, minAge],
    (err, results) => {
        // –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    }
);
```

---

## üõ°Ô∏è¬†**–ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π**

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞—â–∏—Ç–∞:

```sql
-- –ê—Ç–∞–∫–∞: username = "admin' OR '1'='1"
-- –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è:
SELECT * FROM users WHERE username = 'admin' OR '1'='1'
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!

-- Prepared Statement:
-- –®–∞–±–ª–æ–Ω: SELECT * FROM users WHERE username = ?
-- –ü–∞—Ä–∞–º–µ—Ç—Ä: "admin' OR '1'='1"
-- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å: SELECT * FROM users WHERE username = 'admin'' OR ''1''=''1'
-- –ü–∞—Ä–∞–º–µ—Ç—Ä —Ç—Ä–∞–∫—Ç—É–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞, –∞ –Ω–µ –∫–æ–¥
```

### –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö:

|–°–∏—Å—Ç–µ–º–∞|–°–∏–Ω—Ç–∞–∫—Å–∏—Å|–í–Ω–µ—à–Ω–∏–π –≤–∏–¥ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞|
|---|---|---|
|**SQL**|`'admin'' OR ''1''=''1'`|`admin' OR '1'='1`|
|**Java**|`"admin\' OR \'1\'=\'1"`|`admin' OR '1'='1`|
|**JSON**|`"admin\" OR \"1\"=\"1"`|`admin" OR "1"="1`|
|**HTML**|`admin&apos; OR &apos;1&apos;=&apos;1`|`admin' OR '1'='1`|

### –¢–∏–ø—ã –∞—Ç–∞–∫, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞—â–∏—â–∞–µ—Ç:

#### 1.¬†**Classic SQL Injection:**
```sql
-- –í–≤–æ–¥: ' OR 1=1 --
-- Prepared Statement: –ø–∞—Ä–∞–º–µ—Ç—Ä —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
```

#### 2.¬†**Union-based Injection:**
```sql
-- –í–≤–æ–¥: ' UNION SELECT * FROM passwords --
-- Prepared Statement: –≤–µ—Å—å UNION —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∞—Å—Ç—å—é —Å—Ç—Ä–æ–∫–∏
```

#### 3.¬†**Boolean-based Blind Injection:**
```sql
-- –í–≤–æ–¥: ' AND SUBSTRING(database(),1,1)='a' --
-- Prepared Statement: —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∫ SQL
```

---

## üìä¬†**–¢–∏–ø—ã Prepared Statements**

### 1.¬†**Client-side Prepared Statements:**
```js
// –î—Ä–∞–π–≤–µ—Ä —ç–º—É–ª–∏—Ä—É–µ—Ç prepared statements
// –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –¥–µ–ª–∞–µ—Ç —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
const stmt = mysql.createPreparedStatement("SELECT * FROM users WHERE id = ?");
```

### 2.¬†**Server-side Prepared Statements:**
```java
// –ù–∞—Å—Ç–æ—è—â–∏–µ prepared statements –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ë–î
PreparedStatement stmt = connection.prepareStatement(
    "SELECT * FROM users WHERE id = ?"
);
// –°–µ—Ä–≤–µ—Ä –ë–î –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```

### 3.¬†**Protocol-level Prepared Statements:**
```sql
-- –ù–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º –ë–î
PREPARE user_query AS SELECT * FROM users WHERE id = $1;
EXECUTE user_query(100);
DEALLOCATE user_query;
```

---

## üö®¬†**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –Ω—é–∞–Ω—Å—ã**

### –ß—Ç–æ –ù–ï–õ–¨–ó–Ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞—Ç—å:

#### 1.¬†**–ò–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü –∏ —Å—Ç–æ–ª–±—Ü–æ–≤:**

```java
// –ù–ï –†–ê–ë–û–¢–ê–ï–¢
String sql = "SELECT * FROM ? WHERE ? = ?";
PreparedStatement stmt = conn.prepareStatement(sql);
stmt.setString(1, "users");  // –û—à–∏–±–∫–∞!
stmt.setString(2, "name");   // –û—à–∏–±–∫–∞!
stmt.setString(3, "John");   // –û—à–∏–±–∫–∞!
```

#### –†–µ—à–µ–Ω–∏–µ - –±–µ–ª—ã–µ —Å–ø–∏—Å–∫–∏:

```java
// –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫
Set<String> allowedTables = Set.of("users", "products", "orders");
if (!allowedTables.contains(tableName)) {
    throw new SecurityException("Invalid table name");
}
String sql = "SELECT * FROM " + tableName + " WHERE id = ?";
```

#### 2.¬†**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ ORDER BY:**

```java
// –û–ü–ê–°–ù–û - –ø—Ä—è–º–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ
String sql = "SELECT * FROM users ORDER BY " + columnName;

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ - –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫
Map<String, String> allowedColumns = Map.of(
    "name", "username",
    "date", "created_at"
);
String safeColumn = allowedColumns.getOrDefault(columnName, "id");
String sql = "SELECT * FROM users ORDER BY " + safeColumn;
```

#### 3.¬†**LIMIT –∏ OFFSET (–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ë–î):**

```sql
-- MySQL - —Ä–∞–±–æ—Ç–∞–µ—Ç
SELECT * FROM users LIMIT ? OFFSET ?

-- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ë–î —Ç—Ä–µ–±—É—é—Ç –ª–∏—Ç–µ—Ä–∞–ª—ã
SELECT * FROM users LIMIT 10 OFFSET 20
```

---

## üõ°Ô∏è¬†**Best Practices**

### 1.¬†**–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞:**

```java
// –•–û–†–û–®–û
String sql = "SELECT * FROM products WHERE category = ? AND price < ?";
PreparedStatement stmt = conn.prepareStatement(sql);
stmt.setString(1, userCategory);
stmt.setBigDecimal(2, maxPrice);

// –ü–õ–û–•–û
String sql = "SELECT * FROM products WHERE category = '" + userCategory + "'";
```

### 2.¬†**–ü—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã:**

```java
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ try-with-resources
try (PreparedStatement stmt = conn.prepareStatement(sql)) {
    stmt.setString(1, param);
    try (ResultSet rs = stmt.executeQuery()) {
        // –æ–±—Ä–∞–±–æ—Ç–∫–∞
    }
}
```

### 3.¬†**–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**

```java
public void updateUserEmail(int userId, String email) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ prepared statement
    if (!isValidEmail(email)) {
        throw new IllegalArgumentException("Invalid email");
    }
    
    String sql = "UPDATE users SET email = ? WHERE id = ?";
    try (PreparedStatement stmt = conn.prepareStatement(sql)) {
        stmt.setString(1, email);
        stmt.setInt(2, userId);
        stmt.executeUpdate();
    }
}
```

### 4.¬†**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**

```java
// –•–û–†–û–®–û - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
stmt.setInt(1, userId);
stmt.setDate(2, sqlDate);
stmt.setBoolean(3, isActive);

// –ü–õ–û–•–û - –ø–æ—Ç–µ—Ä—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
stmt.setString(1, String.valueOf(userId)); // –í–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏
```

---

## üîç¬†**–û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ prepared statements:

```java
public class LoggingPreparedStatement implements PreparedStatement {
    private void logQuery(String sql, Object[] params) {
        String fullQuery = buildQueryWithParams(sql, params);
        logger.debug("Executing: " + fullQuery);
    }
    
    public ResultSet executeQuery() throws SQLException {
        logQuery(this.sql, this.params);
        return delegate.executeQuery();
    }
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

```sql
-- PostgreSQL - –ø–æ–∏—Å–∫ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö prepared statements
SELECT query, calls, total_time, mean_time
FROM pg_stat_statements 
WHERE query LIKE 'PREPARE%' OR query LIKE 'EXECUTE%'
ORDER BY mean_time DESC;
```

---

## üí°¬†**–ú–∏—Ñ—ã –∏ –ø—Ä–∞–≤–¥–∞**

### –ú–∏—Ñ: "Prepared Statements –º–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞"

**–ü—Ä–∞–≤–¥–∞:**¬†–î–ª—è –æ–¥–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ —Ä–∞–∑–Ω–∏—Ü–∞ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞, –∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ.

### –ú–∏—Ñ: "–û–Ω–∏ –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –≤—Å–µ—Ö SQL-–∏–Ω—ä–µ–∫—Ü–∏–π"

**–ü—Ä–∞–≤–¥–∞:**¬†–ó–∞—â–∏—â–∞—é—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ —É—è–∑–≤–∏–º—ã.

### –ú–∏—Ñ: "–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ"

**–ü—Ä–∞–≤–¥–∞:**¬†–ù–µ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏–º–µ–Ω —Ç–∞–±–ª–∏—Ü/—Å—Ç–æ–ª–±—Ü–æ–≤ - —Ç–∞–º –Ω—É–∂–Ω—ã –±–µ–ª—ã–µ —Å–ø–∏—Å–∫–∏.

---

## üéØ¬†**–ò—Ç–æ–≥: –ü–æ—á–µ–º—É prepared statements –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã**

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**¬†–ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π #1
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**¬†–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**¬†–†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

**–ü—Ä–∞–≤–∏–ª–æ:**¬†–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ prepared statements –¥–ª—è –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤!