# üîç –ê–Ω–∞–ª–∏–∑ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤ –∫–æ–¥–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

```python
from flask import Blueprint
from flask import g
from flask import request
from flask import url_for
from flask import redirect
from flask import render_template

import functools

bp = Blueprint("payments", __name__)


def login_required(view):
	@functools.wraps (view)
	def wrapped_view(**kwargs):
		if g.user is None:
			return redirect(url_for("auth.login"))
		return view(**kwargs)
	return wrapped_view


@bp.route("/")
@login_required
def user_payments(): 
	db = get_db()
	payments = db.execute("SELECT FROM payment WHERE user_id = ? ORDER BY id", 					(g.user["id"],)).fetchall()
	return render_template("payments/payments_list.html", payments=payments)


bp.route("/payment/<int:payment_id>")
@login_required
def view_payment(payment_id):
	db = get_db()
	payment db.execute("SELECT FROM payment WHERE id = ?", (payment_id,)).fetchone() 
	return render_template("payments/payment_details.html", payment=payment)


bp.route("/add_payment", methods=("GET", "POST"))
@login_required
def add_payment():
	if request.method == "POST":
		db = get_db()
		amount = request.form["amount"]
		description = request.form["description"]
		error = None

	if not amount:
		error = "Amount required"
	if not description:
		error = "Description required"

	if error is None:
		db.execute("INSERT INTO payment (user_id, amount, description) VALUES (?, ?, ?)", (g.user["id"], amount, description))
		db.commit()
		return redirect(url_for("payments.user_payments"))

	return render_template("payments/add_payment.html")
```

---
# üö®¬†**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏**

---

## ## 1.¬†**Insecure Direct Object Reference (IDOR)**¬†-¬†**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –†–ò–°–ö**

**–£—è–∑–≤–∏–º–æ—Å—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏–∏¬†`view_payment`:**
``` python
@bp.route("/payment/<int:payment_id>")
def view_payment(payment_id):
    payment = db.execute("SELECT * FROM payment WHERE id = ?", (payment_id,)).fetchone()
```

**–ü—Ä–æ–±–ª–µ–º–∞:**¬†–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–ª–∞—Ç–µ–∂ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –õ–Æ–ë–û–ú–£ –ø–ª–∞—Ç–µ–∂—É –≤ —Å–∏—Å—Ç–µ–º–µ.

**–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:**
```text
/user123 –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø:
/payment/1  # –ü–ª–∞—Ç–µ–∂ user456
/payment/25 # –ü–ª–∞—Ç–µ–∂ admin
```

**–†–∏—Å–∫:**¬†–ö—Ä–∞–∂–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã.

---
## 2.¬†**Missing Input Validation & Business Logic Flaws**¬†-¬†**–í–´–°–û–ö–ò–ô –†–ò–°–ö**

**–£—è–∑–≤–∏–º–æ—Å—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏–∏¬†`add_payment`:**
```python
amount = request.form["amount"]  # –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
### **2.1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö:**

- `amount = "abc"`¬†- –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É –ë–î –∏–ª–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- `amount = ""`¬†- –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø—Ä–æ–π–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É¬†`if not amount`

### **2.2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±–∏–∑–Ω–µ—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

- **–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Å—É–º–º—ã:**¬†`amount = "-1000"`¬†- –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∫—Ä–∞–∂–∞ –¥–µ–Ω–µ–≥
- **–ù—É–ª–µ–≤—ã–µ —Å—É–º–º—ã:**¬†`amount = "0"`¬†- –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**¬†`amount = "9999999999"`¬†- –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
### **2.3. –£—è–∑–≤–∏–º–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

```python
if not amount:
    error = "Amount required"
if not description:
    error = "Description required"  # –ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–¢ –ø—Ä–µ–¥—ã–¥—É—â—É—é –æ—à–∏–±–∫—É!
```

---
## 3.¬†**Cross-Site Scripting (XSS)**¬†-¬†**–í–´–°–û–ö–ò–ô –†–ò–°–ö**

**–£—è–∑–≤–∏–º–æ—Å—Ç—å:**¬†–ü–æ–ª–µ¬†`description`¬†–Ω–µ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π –≤ –ë–î –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤ HTML.

**–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:**
```python
description = "<script>alert('XSS')</script>"
description = "<img src=x onerror=stealCookies()>"
```
**–†–∏—Å–∫:**¬†–ö—Ä–∞–∂–∞ —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ —Ö—Ä–∞–Ω–∏–º—ã–π XSS.

---
## 4.¬†**Cross-Site Request Forgery (CSRF)**¬†-¬†**–í–´–°–û–ö–ò–ô –†–ò–°–ö**

**–£—è–∑–≤–∏–º–æ—Å—Ç—å:**¬†–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç CSRF-–∑–∞—â–∏—Ç–∞ –¥–ª—è —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π.

**–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:**
```python
<!-- –ù–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–º —Å–∞–π—Ç–µ -->
<form action="https://bank.com/add_payment" method="POST">
    <input type="hidden" name="amount" value="1000">
    <input type="hidden" name="description" value="To attacker">
</form>
<script>document.forms[0].submit();</script>
```
**–†–∏—Å–∫:**¬†–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

# **–°–†–ï–î–ù–ò–ï –†–ò–°–ö**

---
## 5.¬†**Error Handling & Information Disclosure**¬†-¬†**–°–†–ï–î–ù–ò–ô –†–ò–°–ö**

**–£—è–∑–≤–∏–º–æ—Å—Ç–∏:**
### **5.1. KeyError –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã:**
```python
amount = request.form["amount"]  # KeyError –µ—Å–ª–∏ –ø–æ–ª—è –Ω–µ—Ç
```

### **5.2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ None –≤ view_payment:**

```python
payment = db.execute(...).fetchone()  # –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å None
return render_template(..., payment=payment)  # –û—à–∏–±–∫–∞ –≤ —à–∞–±–ª–æ–Ω–µ
```

**–†–∏—Å–∫:**¬†–†–∞—Å–∫—Ä—ã—Ç–∏–µ stack traces –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## 6.¬†**Business Logic Vulnerabilities**¬†-¬†**–°–†–ï–î–ù–ò–ô –†–ò–°–ö**

**–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞**¬†–ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º —Å—Ä–µ–¥—Å—Ç–≤
- **–õ–∏–º–∏—Ç—ã –Ω–∞ —Å—É–º–º—É**¬†—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–ê–Ω—Ç–∏-—Ñ—Ä–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏**¬†(–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
- **Audit trail**¬†(–∫—Ç–æ, –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–ª –ø–ª–∞—Ç–µ–∂)

---

## üí°¬†**–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –¥–ª—è AppSec**

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ ownership**¬†- –∫–∞–∂–¥—ã–π —Ä–µ—Å—É—Ä—Å –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
2. **–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –í–°–ï –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**¬†- —Ç–∏–ø, –¥–∏–∞–ø–∞–∑–æ–Ω, —Ñ–æ—Ä–º–∞—Ç, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
3. **–≠–∫—Ä–∞–Ω–∏—Ä—É–π—Ç–µ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**¬†- –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ XSS
4. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ CSRF –∑–∞—â–∏—Ç—É**¬†–¥–ª—è –≤—Å–µ—Ö state-changing –æ–ø–µ—Ä–∞—Ü–∏–π
5. **–ù–µ –¥–æ–≤–µ—Ä—è–π—Ç–µ –∫–ª–∏–µ–Ω—Ç—É**¬†- –≤—Å—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
6. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**¬†–¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤

**–î–∞–Ω–Ω—ã–π –∫–æ–¥ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏, –∫–æ–≥–¥–∞ —Ñ–æ–∫—É—Å –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç –Ω–∞–¥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é, —á—Ç–æ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.**